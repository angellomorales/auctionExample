{% extends "auctions/layout.html" %}

{% block body %}

{% if message %}
<h2>Listing: {{ item.title }} </h2>
<h3>Error:"{{ message }}"</h3>
{% else %}
<h2>Listing: {{ item.title }}</h2>
{% endif %}
<div class="text-center listing">
    {% if item.image %}
    <img src="{{ item.image }}" class="card-img" alt="Image">
    {% else %}
    <img src="https://ctkbiotech.com/wp/wp-content/uploads/2018/03/not-available.jpg" class="card-img" alt="Image">
    {% endif %}
</div>
<div>
    {% if not item.closed %}
    <div>
        <form action="" method="get">

            {% if not isInWatchlist %}
            <input type="hidden" name="watchlistActive" value="add">
            <input type="submit" value=" Add Watchlist">
            {% else %}
            <input type="hidden" name="watchlistActive" value="">
            <input type="submit" value="Remove Watchlist">
            {% endif %}

        </form>
    </div>
    {% endif %}

    {% if item.owner == request.user %}
    <div>
        <form action="" method="get">

            {% if not item.closed %}
            <input type="hidden" name="close" value="True">
            <input type="submit" value=" Close">
            {% else %}
            <input type="submit" value=" Closed" disabled>
            {% endif %}

        </form>
    </div>
    {% endif %}

</div>
<p>{{ item.description }}</p>
<br>

{% if not item.closed %}
<div>

    {% if currentBid %}
    <h2>current price: $ {{ currentBid.currentBid__max }}</h2>
    <div>
        
        {% if currentBid.currentUser == request.user.id %}
        <h5><small class="text-muted">{{ nbids }} bid so far, your bid is the current bid </small></h5>
        {% else %}
        <h5><small class="text-muted">{{ nbids }} bid so far </small></h5>
        {% endif %}
            
    </div>

    {% else %}
    <h2>current price: $ {{ item.initialPrice }}</h2>
    <h5><small class="text-muted">{{ nbids }} bid so far </small></h5>
    {% endif %}



    <form action="" method="post">
        {% csrf_token %}
        {{ form }}
        <input type="submit" value="Bid">
    </form>
</div>
<br>

<h2>Details</h2>
<ul>
    <li>Listed by: {{ item.owner }}</li>
    <li>email: {{ item.owner.email }}</li>
    <li>Category: {{ item.get_category_display }}</li>
    <li>Created: {{ item.dateCreated }}</li>
</ul>

{% else %}

<div>
    {% if item.winner == request.user %}
    <h2>Congratulations!! you win this Auction</h2>
    {% else %}
    <h2>Auction is Closed</h2>
    {% endif %}
</div>


{% endif %}

{% endblock %}